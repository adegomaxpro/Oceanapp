# ğŸŒŠ Ocean Path - Android Signing & CI/CD Guide

This guide explains how to set up automated Android builds with signed APK and AAB files using GitHub Actions.

---

## ğŸ“‹ Overview

The Ocean Path project includes:
- **GitHub Actions Workflow**: Automatically builds signed APK and AAB on every push
- **Keystore Generation Script**: Creates a JKS keystore for Android app signing
- **Secure Secret Management**: All sensitive data stored in GitHub Secrets

---

## ğŸ” Security Features

| Feature | Description |
|---------|-------------|
| **Base64 Encoded Keystore** | Keystore is decoded from secrets at runtime |
| **No Hardcoded Secrets** | All credentials stored in GitHub Secrets |
| **Automatic Cleanup** | Keystore files deleted after build |
| **No Log Exposure** | Secrets never printed to build logs |
| **Script Privacy** | Keystore script does NOT collect system/IP/location data |

---

## ğŸš€ Quick Start

### Step 1: Generate Keystore

#### On Windows (PowerShell):
```powershell
cd scripts
.\generate-keystore.ps1
```

#### On macOS/Linux (Bash):
```bash
cd scripts
chmod +x generate-keystore.sh
./generate-keystore.sh
```

The script will prompt you for:
1. **Common Name (CN)** - Your company or app name
2. **Organizational Unit (OU)** - Department name
3. **Organization (O)** - Company/Organization name
4. **City/Locality (L)** - City name
5. **State/Province (ST)** - State or province
6. **Country Code (C)** - Two-letter country code (e.g., US, UK)
7. **Email Address** - Contact email for the certificate
8. **Key Alias** - Unique identifier for the key
9. **Keystore Password** - Password for the keystore file
10. **Key Password** - Password for the key
11. **Validity Period** - How long the certificate is valid (default: 25 years)

### Step 2: Add Secrets to GitHub

1. Go to your repository on GitHub
2. Navigate to **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. Click **New repository secret**
4. Add the following secrets:

| Secret Name | Description |
|-------------|-------------|
| `OCEANPATH_KEYSTORE_BASE64` | Base64-encoded keystore file |
| `OCEANPATH_KEYSTORE_PASSWORD` | Password for the keystore |
| `OCEANPATH_KEY_ALIAS` | Alias of the signing key |
| `OCEANPATH_KEY_PASSWORD` | Password for the signing key |

### Step 3: Trigger the Build

The workflow automatically runs on:
- Push to `main`, `master`, or `develop` branches
- Pull requests to `main` or `master`
- Manual trigger via GitHub Actions UI

To manually trigger:
1. Go to **Actions** tab in your repository
2. Select **Android Signed Build** workflow
3. Click **Run workflow**

---

## ğŸ“¦ Build Artifacts

After a successful build, download artifacts from:
1. Go to **Actions** tab
2. Click on the completed workflow run
3. Scroll to **Artifacts** section
4. Download:
   - **OceanPath-Release-APK** - Signed APK file
   - **OceanPath-Release-AAB** - Signed App Bundle for Play Store

Artifacts are retained for **30 days**.

---

## ğŸ”§ GitHub Secrets Reference

### Required Secrets

```
OCEANPATH_KEYSTORE_BASE64
â”œâ”€â”€ Type: Base64-encoded JKS file
â”œâ”€â”€ Generated by: generate-keystore script
â””â”€â”€ Purpose: Contains the signing key

OCEANPATH_KEYSTORE_PASSWORD
â”œâ”€â”€ Type: String (min 6 characters)
â”œâ”€â”€ Entered by: User during script execution
â””â”€â”€ Purpose: Unlocks the keystore file

OCEANPATH_KEY_ALIAS
â”œâ”€â”€ Type: String
â”œâ”€â”€ Entered by: User during script execution
â””â”€â”€ Purpose: Identifies the signing key

OCEANPATH_KEY_PASSWORD
â”œâ”€â”€ Type: String (min 6 characters)
â”œâ”€â”€ Entered by: User during script execution
â””â”€â”€ Purpose: Unlocks the signing key
```

---

## ğŸ“ Project Structure

```
Ocean/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ android-build.yml    # GitHub Actions workflow
â”œâ”€â”€ android/
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ build.gradle.kts     # Signing configuration
â”‚       â””â”€â”€ proguard-rules.pro   # ProGuard rules
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ generate-keystore.ps1    # Windows keystore script
â”‚   â””â”€â”€ generate-keystore.sh     # macOS/Linux keystore script
â””â”€â”€ docs/
    â””â”€â”€ ANDROID_SIGNING.md       # This documentation
```

---

## âš ï¸ Important Security Notes

1. **Never commit keystores** - The `.gitignore` is configured to exclude all keystore files
2. **Never share secrets** - Keep your GitHub Secrets confidential
3. **Backup your keystore** - If you lose your keystore, you cannot update your app on Play Store
4. **Use strong passwords** - Minimum 6 characters, but longer is better
5. **Delete backup files** - Remove any `github-secrets-BACKUP-DELETE-AFTER-USE.txt` files after use

---

## ğŸ› ï¸ Troubleshooting

### Build fails with "keystore not found"
- Verify `OCEANPATH_KEYSTORE_BASE64` is correctly set in GitHub Secrets
- Ensure the base64 encoding doesn't have extra whitespace

### Build fails with "wrong password"
- Double-check `OCEANPATH_KEYSTORE_PASSWORD` and `OCEANPATH_KEY_PASSWORD`
- Regenerate the keystore if passwords are lost

### "keytool not found" error
- Install Java JDK (version 11 or higher)
- Add Java to your system PATH

### Script doesn't run on macOS/Linux
```bash
chmod +x scripts/generate-keystore.sh
```

---

## ğŸ“ Privacy Statement

The keystore generation scripts (`generate-keystore.ps1` and `generate-keystore.sh`):

âœ… **DO:**
- Prompt for company/organization details only
- Generate keystore using only provided inputs
- Output base64-encoded keystore and instructions

âŒ **DO NOT:**
- Collect system information
- Read IP addresses or location data
- Auto-fill any values
- Send data to external servers
- Access personal files or directories

All inputs are manually provided by the user. No data is collected or transmitted.

---

## ğŸ“š Additional Resources

- [Android App Signing](https://developer.android.com/studio/publish/app-signing)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Flutter Android Deployment](https://docs.flutter.dev/deployment/android)

---

*Last updated: December 2024*

